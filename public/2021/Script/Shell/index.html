<!DOCTYPE html>
<html>
	<head>
		
<title>Shell脚本备忘与使用（含ffmpeg）-.Backup</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/assets/blog/about/d.webp.jpg">

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="脚本,快速文档,累进式笔记,">
<meta name="description" content="">


<script src="/js/jquery.min.js"></script>


<script src="/js/index.js"></script>


<script src="/js/fancybox.umd.js"></script>


<script src="/js/fancybox-images.js"></script>


<script src="/js/gitalk.min.js"></script>

<!-- 
<script src="/js/hljs.min.js"></script>
  -->
<!-- <script>hljs.highlightAll();</script> -->

	<meta name="generator" content="Hexo 7.3.0"></head>

	<body>
		
	<div class="header">
		<div class="header-top" id="header-top">
			<div class="h-left">
				<a href="/">
					<img src="/assets/blog/about/d.webp.jpg" alt="Quiet">
				</a>
			</div>
			<div class="h-right">
				<ul>
					
						
								<li>
									<a href="/">
										封面
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/tags/快速文档">
										快速文档
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/categories">
										分栏
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/tags">
										标记
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/archives">
										时间线
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/links">
										外链
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/about">
										关于我
									</a>
									<span class="dot"></span>
								</li>
								
									
				</ul>
			</div>
			<div class="h-right-close">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
					<path fill="none" d="M0 0h24v24H0z" />
					<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
				</svg>
			</div>
		</div>
	</div>
	<div class="sidebar">
    <div class="topo">
        <h2>可能是水桶吧</h2>
    </div>
    <ul>
        
        <li>
            <a href="/">封面</a>
        </li>
        
        <li>
            <a href="/tags/快速文档">快速文档</a>
        </li>
        
        <li>
            <a href="/categories">分栏</a>
        </li>
        
        <li>
            <a href="/tags">标记</a>
        </li>
        
        <li>
            <a href="/archives">时间线</a>
        </li>
        
        <li>
            <a href="/links">外链</a>
        </li>
        
        <li>
            <a href="/about">关于我</a>
        </li>
        
    </ul>
    <div class="my_foot">
        
        <a target="_blank" rel="noopener" href="https://visnz.zcool.com.cn/">
            <img src="/assets/website/zcool-icon2.png" alt="Quiet主题">
        </a>
        
        <a target="_blank" rel="noopener" href="https://www.xiaohongshu.com/user/profile/599e99f650c4b40fb927384f">
            <img src="/assets/website/xhs-icon.png" alt="Quiet主题">
        </a>
        
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/20477830">
            <img src="/assets/website/bilibili-icon.png" alt="Quiet主题">
        </a>
        
        <a href="/assets/blog/about/QQ_QRCode.jpg">
            <img src="/assets/website/QQ-icon.png" alt="Quiet主题">
        </a>
        
    </div>
</div>
<div class='shelter'>
</div>
<style>
    .shelter{
        background-color: #333;
        opacity:0.5;
        cursor: pointer;
        display: none; 
        position: fixed;
        left: 0;
        top: 0; 
        right: 0;
        bottom: 0;
        z-index: 1998;
    }
    .sidebar {
        width: 66%;
        height: 100%;
        position: fixed;
        top: 0;
        right: -100%;
        bottom: 0;
        background: #fff;
        z-index: 1999;
        text-align: center;
        box-shadow: -6px 0 20px rgba(98, 94, 94, .815);
    }

    .topo {
        width: 100%;
        height: 200px;
        background: url(/assets/blog/about/d.webp.jpg) no-repeat;
        background-size: 100% 100%;
        position: relative;
        display: flex;
        align-items: flex-end
    }

    .topo h2 {
        color: #fff;
        z-index: 1;
        position: relative;
        margin: 0 0 10px 10px;
        font-size: 1.2em;
        box-sizing: border-box
    }

    .topo:before {
        content: '';
        background-image: url(/image/pattern.png);
        background-repeat: repeat;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1
    }

    .sidebar ul {
        width: 100%;
        margin-top: 50px
    }

    .sidebar ul li {
        height: 50px;
        list-style: none;
        font-size: 1.2em;
        text-align: right;
        margin-right: 10px
    }

    .sidebar ul li a {
        display: grid;
        color: #5d606a;
        text-overflow: ellipsis;
        width: 100%;
        text-decoration: none
    }

    .my_foot {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        position: absolute;
        bottom: 0
    }

    .my_foot a {
        text-decoration: none;
        margin-right: 10px;
        display: inline-block
    }

    .my_foot a img {
        width: 30px;
        height: 30px
    }
</style>

<script>
    $( function () {
	$( '.h-right-close>svg' )
		.click( function () {
			$( '.sidebar' )
				.animate( {
					right: "0"
				}, 500 );
			$( '.shelter' )
				.fadeIn( "slow" )
		} );
	$( '.shelter' )
		.click( function ( e ) {
			$( '.sidebar' )
				.animate( {
					right: "-100%"
				}, 500 );
			$( '.shelter' )
				.fadeOut( "slow" )
		} )
} )

</script>

<div class="post">
    <div class="post-header-background post-header-img"
    style="background: url('/assets/blog/about/d.webp.jpg');background-repeat:no-repeat;background-position:top;" 
>
    <div class="post-header-background-content">
        <ul class="post-header-tag">
            
            
            <li><a href="/tags/脚本">脚本</a></li>
            
            <li><a href="/tags/快速文档">快速文档</a></li>
            
            <li><a href="/tags/累进式笔记">累进式笔记</a></li>
            
            
        </ul>
        
        <h1>Shell脚本备忘与使用（含ffmpeg）</h1>
        <div class="post-header-info">
            <div class="post-header-info-author">
                
                    <svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
                        <path
                            d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
                            p-id="2902" fill="#ffffff"></path>
                    </svg>
                    
                <span class="post-header-info-author-text"> <a href="/index.html">可能是水桶吧</a></span>
                <div class="post-header-info-author-categories">
                    
                        
                            <a href="/categories/脚本相关/" target="_blank" >脚本相关</a>
                        
                    
                </div>
                <p>2021-04-06 14:53:16</p>
            </div>
        </div>
    </div>
</div>
    <div class="post-content" id="content">
  
  <div id="article" class="post-content-info">
    

    <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ol>
<li><a href="#1-Shell%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%94%A8%E4%BE%8B">Shell基础入门用例</a></li>
<li><a href="#2-Shell%E6%88%90%E5%93%81%E8%84%9A%E6%9C%AC%EF%BC%88%E6%91%98%E6%8A%84%EF%BC%89">Shell成品脚本（摘抄）</a><ol>
<li><a href="#2-1-%E8%87%AA%E5%8A%A8%E9%97%B4%E9%9A%94%E6%88%AA%E5%B1%8F%E4%BF%9D%E5%AD%98">自动间隔截屏保存</a></li>
<li><a href="#2-2-%E6%8A%8Aoc%E6%B8%B2%E6%9F%93%E5%BA%8F%E5%88%97%E5%B8%A7%EF%BC%8C%E5%88%86%E5%88%B0%E5%90%84%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E9%87%8C">把oc渲染序列帧，分到各个文件夹里</a></li>
<li><a href="#2-3-ffmpeg%E6%8A%8Aoc%E6%B8%B2%E6%9F%93%E5%BA%8F%E5%88%97%E5%B8%A7%EF%BC%8C%E5%A4%84%E7%90%86%E6%88%90%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6">ffmpeg把oc渲染序列帧，处理成视频文件</a></li>
</ol>
</li>
<li><a href="#3-%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1Magick%E6%8E%A2%E7%B4%A2%E6%80%A7%E7%AE%A1%E7%BA%BF">记录一次Magick探索性管线</a><ol>
<li><a href="#3-1-%E4%BD%BF%E7%94%A8Magick%E5%81%9A%E5%9B%BE%E7%89%87%E6%B7%B7%E5%90%88%E7%9A%84pre-%E5%90%8E%E5%A4%84%E7%90%86">使用Magick做图片混合的pre-后处理</a></li>
<li><a href="#3-2-magick%E4%B8%BA%E8%B4%B4%E5%9B%BE%E5%BA%93%E5%BB%BA%E7%AB%8B%E9%A2%84%E8%A7%88%E5%9B%BE%E7%B4%A2%E5%BC%95">magick为贴图库建立预览图索引</a></li>
</ol>
</li>
<li><a href="#4-FFmpeg%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95">FFmpeg实战记录</a></li>
</ol>
<h1 id="1-Shell基础入门用例"><a href="#1-Shell基础入门用例" class="headerlink" title="1. Shell基础入门用例"></a>1. Shell基础入门用例</h1><ol>
<li><p>用处：处理G001开头的文件命名错误，转换为G003开头<br><code>for i in `ls|grep G001`;do mv $i `echo $i |sed &#39;s/G001/G003/g&#39;`;done</code></p>
</li>
<li><p>渲染序列预处理脚本获取文件夹内第一个文件名：<br><code>ls -l | grep &#39;^-&#39;|awk -F&quot; &quot; &#39;&#123;print $9&#125;&#39;|grep &#39;[0-9][0-9][0-9][0-9]\.&#39;|head -n 1</code></p>
</li>
<li><p>获取起始帧编码数：<br><code>ls -l | grep &#39;^-&#39;|awk -F&quot; &quot; &#39;&#123;print $9&#125;&#39;|grep &#39;[0-9][0-9][0-9][0-9]\.&#39;|head -n 1|awk -F&quot;.&quot; &#39;&#123;print $1&#125;&#39;|tail -c 5</code></p>
</li>
<li><p>数字转换成可表达的<br><code>sed &#39;s/0000\./%04d\./&#39;</code></p>
</li>
<li><p>ffmpeg cfhd操作<br><code>ffmpeg -start_number 0059 -i $encodefile -c:v cfhd -b 200M $targetfile</code></p>
</li>
<li><p>获取当前文件夹名：<br><code>basenamepwd|sed &#39;s/\ /_/&#39;</code></p>
</li>
<li><p>获取当前目录下的文件夹<br><code>ls -l | grep &#39;/&#39;|awk -F&quot; &quot; &#39;&#123;print $9&#125;&#39;</code></p>
</li>
<li><p>获取子目录下的第一个文件名：<br><code>for i in `ls -l | grep &#39;/&#39;|awk -F&quot; &quot; &#39;&#123;print $9&#125;&#39;`;do ls $i -l | grep &#39;^-&#39;|head -n 1|awk -F&quot; &quot; &#39;&#123;print $9&#125;&#39;;done</code></p>
</li>
</ol>
<h1 id="2-Shell成品脚本（摘抄）"><a href="#2-Shell成品脚本（摘抄）" class="headerlink" title="2. Shell成品脚本（摘抄）"></a>2. Shell成品脚本（摘抄）</h1><h2 id="2-1-自动间隔截屏保存"><a href="#2-1-自动间隔截屏保存" class="headerlink" title="2.1 自动间隔截屏保存"></a>2.1 自动间隔截屏保存</h2><blockquote>
<p>该功能已经转用python实现，<a target="_blank" rel="noopener" href="https://github.com/visnz/screenshot-sh">项目地址</a></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> [ 1 ] ;</span><br><span class="line"><span class="keyword">do</span> <span class="built_in">mkdir</span> /e/每日截屏/`<span class="built_in">date</span> +<span class="string">&quot;%m-%d&quot;</span>` &gt;/dev/null 2&gt;&amp;1;</span><br><span class="line">ffmpeg -f gdigrab -i desktop -s 2240x720 /d/每日截屏/`<span class="built_in">date</span> +<span class="string">&quot;%m-%d&quot;</span>`/screenshot-`<span class="built_in">date</span> +<span class="string">&quot;%d %T&quot;</span> | sed -e <span class="string">&quot;s/ /-/g; s/:/-/g&quot;</span>`.jpg &gt;/dev/null 2&gt;&amp;1;</span><br><span class="line"><span class="built_in">sleep</span> 10 ;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>图片确实是截了，按照时间截的，不按顺序，串不起来视频。<br>还需要一个脚本，把所有图按照创建时间顺序命名，转成中间件视频格式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">STEMP=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> -l | grep -v <span class="string">&#x27;/&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>`;</span><br><span class="line"><span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span>;</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$i</span> screenshot`<span class="built_in">printf</span> <span class="string">&quot;%05d&quot;</span> <span class="variable">$STEMP</span>`.jpg;<span class="built_in">let</span> <span class="string">&quot;STEMP += 1&quot;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">firstfile=`<span class="built_in">ls</span> -l | grep <span class="string">&#x27;^-&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|grep <span class="string">&#x27;[0-9][0-9][0-9][0-9]\.&#x27;</span>|<span class="built_in">head</span> -n 1`</span><br><span class="line">index=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -c 5;`</span><br><span class="line">encodefile=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|sed <span class="string">&quot;s/<span class="variable">$index</span>\./%04d\./&quot;</span>`</span><br><span class="line">sstemp=`<span class="built_in">basename</span> <span class="variable">$PWD</span>`</span><br><span class="line">targetfile=../`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|<span class="built_in">head</span> -c -10`_<span class="variable">$sstemp</span><span class="string">&#x27;.mov&#x27;</span></span><br><span class="line">ffmpeg -start_number <span class="variable">$index</span> -i <span class="variable">$encodefile</span> -vcodec mpeg4 -b 30M <span class="variable">$targetfile</span> -y</span><br></pre></td></tr></table></figure>

<p>然后就可以获得带mpeg4编码的中间件了。</p>
<p>在截图文件夹直接调用这个脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">ls</span> -l | grep <span class="string">&#x27;/&#x27;</span>| grep -v <span class="string">&#x27;done&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>`;</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">STEMP=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> <span class="variable">$j</span> -l | grep -v <span class="string">&#x27;/&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>`;</span><br><span class="line"><span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span>;</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$j</span>/<span class="variable">$i</span> <span class="variable">$j</span>/screenshot`<span class="built_in">printf</span> <span class="string">&quot;%05d&quot;</span> <span class="variable">$STEMP</span>`.jpg;<span class="built_in">let</span> <span class="string">&quot;STEMP += 1&quot;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">firstfile=`<span class="built_in">ls</span> <span class="variable">$j</span> -l | grep <span class="string">&#x27;^-&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|grep <span class="string">&#x27;[0-9][0-9][0-9][0-9]\.&#x27;</span>|<span class="built_in">head</span> -n 1`</span><br><span class="line">index=`<span class="built_in">echo</span> <span class="variable">$j</span>/<span class="variable">$firstfile</span>|awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -c 5;`</span><br><span class="line">encodefile=`<span class="built_in">echo</span> <span class="variable">$j</span>/<span class="variable">$firstfile</span>|sed <span class="string">&quot;s/<span class="variable">$index</span>\./%04d\./&quot;</span>`</span><br><span class="line">sstemp=`<span class="built_in">basename</span> <span class="variable">$j</span>`</span><br><span class="line">targetfile=./`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|<span class="built_in">head</span> -c -10`_<span class="variable">$sstemp</span><span class="string">&#x27;.mov&#x27;</span></span><br><span class="line">ffmpeg -start_number <span class="variable">$index</span> -i <span class="variable">$encodefile</span> -vcodec mpeg4 -b 30M <span class="variable">$targetfile</span> -y</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$j</span> `<span class="built_in">echo</span> <span class="keyword">done</span><span class="variable">$j</span>`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-把oc渲染序列帧，分到各个文件夹里"><a href="#2-2-把oc渲染序列帧，分到各个文件夹里" class="headerlink" title="2.2 把oc渲染序列帧，分到各个文件夹里"></a>2.2 把oc渲染序列帧，分到各个文件夹里</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> -l|awk <span class="string">&#x27;&#123; print $9 &#125;&#x27;</span>|awk -F_0 <span class="string">&#x27;&#123; print $1 &#125;&#x27;</span>`;<span class="keyword">do</span> <span class="built_in">mkdir</span> <span class="variable">$i</span> 2&gt;&amp;1;<span class="keyword">done</span>;<span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> |grep / | awk -F/ <span class="string">&#x27;&#123; print $1 &#125;&#x27;</span>`;<span class="keyword">do</span> <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">ls</span>|grep <span class="variable">$i</span><span class="string">&#x27;_0&#x27;</span> |grep -v /`;<span class="keyword">do</span> <span class="built_in">mv</span> <span class="variable">$j</span> ./<span class="variable">$i</span>/<span class="variable">$j</span>;<span class="keyword">done</span>  ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-ffmpeg把oc渲染序列帧，处理成视频文件"><a href="#2-3-ffmpeg把oc渲染序列帧，处理成视频文件" class="headerlink" title="2.3 ffmpeg把oc渲染序列帧，处理成视频文件"></a>2.3 ffmpeg把oc渲染序列帧，处理成视频文件</h2><p>常规文件处理：将当前文件夹内的序列帧处理成视频</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firstfile=`<span class="built_in">ls</span> -l | grep <span class="string">&#x27;^-&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|grep <span class="string">&#x27;[0-9][0-9][0-9][0-9]\.&#x27;</span>|<span class="built_in">head</span> -n 1`</span><br><span class="line">index=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -c 5;`</span><br><span class="line">encodefile=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|sed <span class="string">&quot;s/<span class="variable">$index</span>\./%04d\./&quot;</span>`</span><br><span class="line">targetfile=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|<span class="built_in">head</span> -c -10`<span class="string">&#x27;.mov&#x27;</span></span><br><span class="line">ffmpeg -r 30 -start_number <span class="variable">$index</span> -i <span class="variable">$encodefile</span> -vcodec cfhd -b 200M <span class="variable">$targetfile</span> -y</span><br></pre></td></tr></table></figure>


<p>批量文件夹内部处理：在oc渲染结果所在文件夹使用，把所有序列转换成cfhd视频素材，生成到..&#x2F;..&#x2F;Precomp文件夹中（会覆盖）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> -l | grep <span class="string">&#x27;/&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>`;</span><br><span class="line"><span class="keyword">do</span> firstfile=`<span class="built_in">ls</span> <span class="variable">$i</span> -l | grep <span class="string">&#x27;^-&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|grep <span class="string">&#x27;[0-9][0-9][0-9][0-9]\.&#x27;</span>|<span class="built_in">head</span> -n 1`;</span><br><span class="line">index=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -c 5;`; </span><br><span class="line">encodefile=`<span class="built_in">echo</span> $i<span class="variable">$firstfile</span>|sed <span class="string">&quot;s/<span class="variable">$index</span>\./%04d\./&quot;</span>`; </span><br><span class="line">targetfile=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|<span class="built_in">head</span> -c -10`<span class="string">&#x27;.mov&#x27;</span>; </span><br><span class="line">tmpcurDIR=`<span class="built_in">pwd</span>|sed <span class="string">&#x27;s/\ /_/&#x27;</span>`;</span><br><span class="line">outputDIR=../../Precomp/`<span class="built_in">basename</span> <span class="variable">$tmpcurDIR</span>`/<span class="variable">$targetfile</span>;</span><br><span class="line"><span class="built_in">mkdir</span> ../../Precomp;</span><br><span class="line"><span class="built_in">mkdir</span> ../../Precomp/`<span class="built_in">basename</span> <span class="variable">$tmpcurDIR</span>`;</span><br><span class="line">ffmpeg -r 30 -start_number <span class="variable">$index</span> -i <span class="variable">$encodefile</span> -vcodec cfhd -b 200M <span class="variable">$outputDIR</span> -y ;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<p>另外，由于cfhd不支持竖屏，竖屏的编码要换用h264</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> -l | grep <span class="string">&#x27;/&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>`;</span><br><span class="line"><span class="keyword">do</span> firstfile=`<span class="built_in">ls</span> <span class="variable">$i</span> -l | grep <span class="string">&#x27;^-&#x27;</span>|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>|grep <span class="string">&#x27;[0-9][0-9][0-9][0-9]\.&#x27;</span>|<span class="built_in">head</span> -n 1`;</span><br><span class="line">index=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|awk -F<span class="string">&quot;.&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -c 5;`; </span><br><span class="line">encodefile=`<span class="built_in">echo</span> $i<span class="variable">$firstfile</span>|sed <span class="string">&quot;s/<span class="variable">$index</span>\./%04d\./&quot;</span>`; </span><br><span class="line">targetfile=`<span class="built_in">echo</span> <span class="variable">$firstfile</span>|<span class="built_in">head</span> -c -10`<span class="string">&#x27;.mp4&#x27;</span>; </span><br><span class="line">tmpcurDIR=`<span class="built_in">pwd</span>|sed <span class="string">&#x27;s/\ /_/&#x27;</span>`;</span><br><span class="line">outputDIR=../../Precomp/`<span class="built_in">basename</span> <span class="variable">$tmpcurDIR</span>`/<span class="variable">$targetfile</span>;</span><br><span class="line"><span class="built_in">mkdir</span> ../../Precomp;</span><br><span class="line"><span class="built_in">mkdir</span> ../../Precomp/`<span class="built_in">basename</span> <span class="variable">$tmpcurDIR</span>`;</span><br><span class="line">ffmpeg -r 30 -start_number <span class="variable">$index</span> -i <span class="variable">$encodefile</span> -vcodec libx264 -b 100M <span class="variable">$outputDIR</span> -y ;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="3-Magick的探索性"><a href="#3-Magick的探索性" class="headerlink" title="3. Magick的探索性"></a>3. Magick的探索性</h1><h2 id="3-1-使用Magick做图片混合的pre-后处理"><a href="#3-1-使用Magick做图片混合的pre-后处理" class="headerlink" title="3.1 使用Magick做图片混合的pre-后处理"></a>3.1 使用Magick做图片混合的pre-后处理</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol>
<li>由于oc渲染出来好多png，在归档时候只要保留其中一些，如一个“Main+SLi(softlight20%)”的AE操作就要占用两个序列帧。</li>
<li>有一些比较简单的处理，就想直接写个脚本混合，不想进AE里去调整，不然还要每次命名不同替换多个序列。</li>
</ol>
<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><ol>
<li>尝试使用Magick的合成结合shell的批处理能力，对多个序列帧进行前期的预加工。</li>
<li>其实OC新版本里内置的AOV已经解决了这个问题，可以前期直接AOV叠出来。不过对于带alpha的图好像依然有bug</li>
<li>不再建议探索以下脚本，仅记录。因为处理效果远比AE慢多了。</li>
</ol>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>OC渲染Cstm通道的时候会三个mask混合在一个通道<br><img src="/assets/blog/script/shell2.webp"><br>有时候需要单独一个通道提取出来，懒得进ps和ae做映射</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">magick</span>.exe Cstm2_0000.png -color-matrix &#x27; <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> &#x27; <span class="number">1</span>.png</span><br></pre></td></tr></table></figure>
<p><img src="/assets/blog/script/shell1.webp" alt="红色！得到了！"></p>
<p>以下为某个特定项目的记录，给自己提供思路和语法参考</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 角色皮肤颜色修正  取C2R通道为mask，以diffi颜色混合叠加到原图上</span></span><br><span class="line"><span class="attribute">magick</span>.exe Cstm2_0000.png -color-matrix &#x27; .<span class="number">8</span> <span class="number">0</span> <span class="number">0</span> .<span class="number">8</span> <span class="number">0</span> <span class="number">0</span> .<span class="number">8</span> <span class="number">0</span> <span class="number">0</span> &#x27; -colorspace RGB rose:A ;</span><br><span class="line"><span class="attribute">magick</span>.exe Final0000.png -compose colorize DifFi_0000.png -alpha Set rose:A -composite <span class="number">1</span>.<span class="number">8</span>.png;</span><br></pre></td></tr></table></figure>
<p>运行的主脚本：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 颜色校准</span></span><br><span class="line">magick.exe Cstm18/`<span class="built_in">ls</span> Cstm18/|grep <span class="variable">$index</span>` -color-matrix <span class="string">&#x27; 1 0 0 1 0 0 1 0 0 &#x27;</span> -colorspace RGB rose:C18R;</span><br><span class="line">magick.exe DeMain/`<span class="built_in">ls</span> DeMain/|grep <span class="variable">$index</span>` -compose colorize DifFi/`<span class="built_in">ls</span> DifFi/|grep <span class="variable">$index</span>` -alpha Set rose:C18R -composite rose:temp;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;肤色校准完成&#x27;</span>;</span><br><span class="line"><span class="comment"># 角色光模糊混合</span></span><br><span class="line">magick.exe Li7/`<span class="built_in">ls</span> Li7/|grep <span class="variable">$index</span>` -blur 2x2 -alpha <span class="built_in">set</span> -channel A -evaluate <span class="built_in">set</span> 15% rose:Li2B;</span><br><span class="line">magick.exe rose:temp -compose softlight rose:Li2B -alpha <span class="built_in">set</span> rose:C18R -composite rose:temp;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;角色光模糊混合完成&#x27;</span>;</span><br><span class="line"><span class="comment"># Ref叠加</span></span><br><span class="line">magick.exe rose:temp \</span><br><span class="line">  \( Ref/`<span class="built_in">ls</span> Ref/|grep <span class="variable">$index</span>` -blur 1x1 -alpha <span class="built_in">set</span> -channel A -evaluate <span class="built_in">set</span> 25% \) \</span><br><span class="line">  -compose Screen -composite rose:temp;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;Ref叠加完成&#x27;</span>;</span><br><span class="line"><span class="comment"># AO叠加</span></span><br><span class="line">magick.exe rose:temp \</span><br><span class="line">  \( AO/`<span class="built_in">ls</span> AO/|grep <span class="variable">$index</span>` -blur 1x1 -alpha <span class="built_in">set</span> -channel A -evaluate <span class="built_in">set</span> 5% \) \</span><br><span class="line">  -compose Multiply -composite rose:AOFE;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;AO叠加完成&#x27;</span>;</span><br><span class="line"><span class="comment"># AO边缘强化</span></span><br><span class="line">magick.exe convert AO/`<span class="built_in">ls</span> AO/|grep <span class="variable">$index</span>` -edge 1 -blur 1x1 -colorspace RGB rose:AOFE;</span><br><span class="line">magick.exe rose:temp \</span><br><span class="line">  \( rose:AOFE -alpha <span class="built_in">set</span> -channel A -evaluate <span class="built_in">set</span> 25% \) \</span><br><span class="line">  -compose Softlight -composite rose:temp;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;AO边缘强化完成&#x27;</span>;</span><br><span class="line"><span class="comment"># 最后调整(-modulate :亮度、饱和度、色相）</span></span><br><span class="line">magick.exe convert rose:temp -modulate 100,105 -adaptive-sharpen 1 -brightness-contrast 5x2 <span class="variable">$basename</span>\_<span class="variable">$index</span>.png;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$index</span><span class="string">&#x27;最后调整完成&#x27;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">rm</span> rose</span><br></pre></td></tr></table></figure>
<p>模糊处理的备忘录</p>
<figure class="highlight julia"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 模糊处理的备忘录</span></span><br><span class="line">magick.exe <span class="built_in">Ref</span>/MV_PinkWorldStage_1229_Final__Ref_0000.png -blur <span class="number">5</span>x5 rose:<span class="built_in">Ref</span>;</span><br><span class="line">magick composite -blend <span class="number">50</span> <span class="built_in">Ref</span>/MV_PinkWorldStage_1229_Final__Ref_0000.png rose:<span class="built_in">Ref</span> -alpha <span class="built_in">Set</span> blend_blur_0.jpg</span><br></pre></td></tr></table></figure>

<p>但是整体的处理效果非常慢，比不上ae的合成速度</p>
<h2 id="3-2-magick为贴图库建立预览图索引"><a href="#3-2-magick为贴图库建立预览图索引" class="headerlink" title="3.2 magick为贴图库建立预览图索引"></a>3.2 magick为贴图库建立预览图索引</h2><h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>之前有一次下载了接近300G的材质贴图库，但是每一个都类似这样的，没有一个索引。要找起贴图来很麻烦<br><img src="/assets/blog/script/shell3.webp" alt="示意图"><br>所以想把里面每个文件夹的贴图拼合成一个拼图，方便查找，像这样<br><img src="/assets/blog/script/shell4.webp"></p>
<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> rdir <span class="keyword">in</span> ./*/; <span class="keyword">do</span> <span class="built_in">ls</span> <span class="variable">$rdir</span>/**/ -d; <span class="keyword">done</span> &gt; list;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> list`;</span><br><span class="line"><span class="keyword">do</span> magick.exe montage -geometry +0+0 -tile 5x4 -resize 512x512 <span class="variable">$i</span>/* /k/资产/`<span class="built_in">echo</span> <span class="variable">$i</span>|sed <span class="string">&#x27;s/\//_/g&#x27;</span>|sed <span class="string">&#x27;s/\.//g&#x27;</span>|sed <span class="string">&#x27;s/\__/_/g&#x27;</span>`.jpg;</span><br><span class="line"><span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>
<p>第一行先筛选需要处理的目录<br>然后用一个for遍历每个地址，把每个地址中的图片合集，以平铺512*512的方式组合，名字由目录名字决定。</p>
<h3 id="解决过程详解"><a href="#解决过程详解" class="headerlink" title="解决过程详解"></a>解决过程详解</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> rdir <span class="keyword">in</span> ./*/; <span class="keyword">do</span> <span class="built_in">ls</span> <span class="variable">$rdir</span>/**/ -d; <span class="keyword">done</span> &gt; list</span><br><span class="line"><span class="comment">## 将当前目录所有子目录输出到一个文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> list`;</span><br><span class="line"><span class="comment">## 遍历文件，获得每一个目录</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line"><span class="built_in">ls</span> <span class="variable">$i</span> -l| grep ^-|awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $9&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">## 输出每个目录，获取文件名，这一步非必要</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>  /k/资产/`<span class="built_in">echo</span> <span class="variable">$i</span>|sed <span class="string">&#x27;s/\//_/g&#x27;</span>|sed <span class="string">&#x27;s/\.//g&#x27;</span>|sed <span class="string">&#x27;s/\__/_/g&#x27;</span>`.jpg</span><br><span class="line"><span class="comment">## 输出输出目的名，这一步非必要</span></span><br><span class="line"></span><br><span class="line">magick.exe montage -geometry +0+0 -tile 5x4 -resize 512x512 <span class="variable">$i</span>/* /k/资产/`<span class="built_in">echo</span> <span class="variable">$i</span>|sed <span class="string">&#x27;s/\//_/g&#x27;</span>|sed <span class="string">&#x27;s/\.//g&#x27;</span>|sed <span class="string">&#x27;s/\__/_/g&#x27;</span>`.jpg</span><br><span class="line"><span class="comment">## 使用montage子工具，5*4方格，大小为512*512</span></span><br><span class="line"><span class="comment">## 选择$i/* 目录下的所有文件</span></span><br><span class="line"><span class="comment">## 输出到目的名所在地址，用sed将/转换为_</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 2</span><br><span class="line"><span class="comment">## 等待2秒，这一步非必要</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>材质贴图库已经删掉了，实在没有这么多空间存储这些利用率这么低的东西。不过建立的索引图以名字保存，倒是保留了下来。因为靠这些名字基本到网上都可以找到这个材质球的贴图。<br><img src="/assets/blog/script/shell5.webp"></p>
<h1 id="4-FFmpeg实战记录"><a href="#4-FFmpeg实战记录" class="headerlink" title="4. FFmpeg实战记录"></a>4. FFmpeg实战记录</h1><blockquote>
<p>ffmpeg是一套综合的音视频编辑工具，支持录屏、编码、剪辑、混合等多种复杂功能，支持市面上大部分的编码格式转换，常见的“格式工厂”、“小丸工具箱”、“Potplayer”等底层均为ffmpeg。配合bash&#x2F;cmd命令行工具，可以提供强大的批量编辑和处理音视频内容的功能。</p>
</blockquote>
<h2 id="目前已应用场景"><a href="#目前已应用场景" class="headerlink" title="目前已应用场景"></a>目前已应用场景</h2><ol>
<li>将序列帧批量转换为cfhd编码，作为后期处理的预合成。在极小损失质量的情况下，减少磁盘频繁读取序列帧的压力。</li>
<li>抓取M3u8网页视频流，为视频批量添加水印</li>
<li>各种格式和编码的转换（mov转mp4、cfhd转mpeg4）</li>
<li>给影视素材批量上luts</li>
<li>截取视频片段输出gif</li>
<li>视频缩放大小和码率输出，压缩成一个小的视频</li>
</ol>
<h2 id="windows安装（基于gitbash）"><a href="#windows安装（基于gitbash）" class="headerlink" title="windows安装（基于gitbash）"></a>windows安装（基于gitbash）</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/BtbN/FFmpeg-Builds/releases">FFMPEG下载</a>，选择下载对应系统版本如 <a target="_blank" rel="noopener" href="https://github.com/BtbN/FFmpeg-Builds/releases/download/autobuild-2021-10-13-12-21/ffmpeg-N-104333-g13141339c1-win64-gpl.zip">ffmpeg-N-104333-g13141339c1-win64-gpl.zip</a>。将文件解压在一个固定不常移动的地方如 “C:\Program Files”之下。<br><img src="/assets/blog/script/shell6.webp"><br><img src="/assets/blog/script/shell7.webp"></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://git-scm.com/downloads">gitbash</a>下载，带有一个bash控制台和虚拟shell环境，可以在任意地方调用bash<br><img src="/assets/blog/script/shell8.webp"></p>
</li>
<li><p>安装完成后，可以在任意文件夹右键调出“gitbash”并运行“ffmpeg.exe”，如有反应则为安装成功<br><img src="/assets/blog/script/shell9.webp"></p>
</li>
</ol>
<h2 id="使用案例详解"><a href="#使用案例详解" class="headerlink" title="使用案例详解"></a>使用案例详解</h2><h3 id="1-在不重新编码视频的情况下，替换音频"><a href="#1-在不重新编码视频的情况下，替换音频" class="headerlink" title="1 在不重新编码视频的情况下，替换音频"></a>1 在不重新编码视频的情况下，替换音频</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ffmpeg -<span class="selector-tag">i</span> v<span class="selector-class">.mp4</span> -<span class="selector-tag">i</span> <span class="selector-tag">a</span><span class="selector-class">.wav</span> -c:v copy -map <span class="number">0</span>:v:<span class="number">0</span> -map <span class="number">1</span>:<span class="selector-tag">a</span>:<span class="number">0</span> new.mp4</span><br></pre></td></tr></table></figure>
<p><img src="/assets/blog/script/shell10.webp"></p>
<h3 id="2-将渲染帧序列，编码为视频"><a href="#2-将渲染帧序列，编码为视频" class="headerlink" title="2 将渲染帧序列，编码为视频"></a>2 将渲染帧序列，编码为视频</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ffmpeg</span> -i Cam03_0923_00%<span class="number">02</span>d.png -c:v mpeg4 <span class="number">1</span>.mp4</span><br></pre></td></tr></table></figure>
<p><img src="/assets/blog/script/shell11.webp"></p>
<h3 id="3-ffmpeg抓取blob协议链接视频"><a href="#3-ffmpeg抓取blob协议链接视频" class="headerlink" title="3 ffmpeg抓取blob协议链接视频"></a>3 ffmpeg抓取blob协议链接视频</h3><blockquote>
<p>这里记录了探索过程，操作上建议直接看3 修订</p>
</blockquote>
<p><img src="/assets/blog/script/shell12.webp"></p>
<p>在网上需要下载一些视频，发现视频引向的协议是blob:&#x2F;&#x2F; 开头，没办法直接下载。</p>
<p>使用<code>ffmpeg</code>直接下载m3u8视频流。</p>
<ol>
<li>准备<code>ffmpeg</code>：</li>
<li><a target="_blank" rel="noopener" href="https://www.filehorse.com/download-ffmpeg/">windows下载</a>（bin文件夹中）</li>
<li><a target="_blank" rel="noopener" href="https://evermeet.cx/ffmpeg/">Mac下载</a>（mac如右图，下载最新即可）</li>
<li>运行cmd &#x2F; 终端，切换到软件所在路径。<br><img src="/assets/blog/script/shell13.webp"><br><img src="/assets/blog/script/shell14.webp" alt="点击播放视频，右侧会出现对应文件，复制m3u8文件链接 "></li>
<li>按照基本命令下载ffmpeg -i [m3u8地址] 输出文件名.mp4<br><img src="/assets/blog/script/shell15.webp"></li>
</ol>
<h3 id="4-修订"><a href="#4-修订" class="headerlink" title="4 修订"></a>4 修订</h3><p>使用<a target="_blank" rel="noopener" href="https://github.com/xifangczy/cat-catch">猫抓</a>可以直接在线调用ffmpeg下载m3u8</p>
<h2 id="操作备忘录"><a href="#操作备忘录" class="headerlink" title="操作备忘录"></a>操作备忘录</h2><ol>
<li>将mov格式转码为mp4格式（不转换编码，需要编码支持）<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ffmpeg -<span class="selector-tag">i</span> <span class="selector-tag">input</span><span class="selector-class">.mov</span> output<span class="selector-class">.mp4</span> </span><br></pre></td></tr></table></figure></li>
<li>视频转序列帧  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ffmpeg -<span class="selector-tag">i</span> <span class="selector-tag">video</span><span class="selector-class">.mov</span> frames.%<span class="number">04</span>d<span class="selector-class">.jpg</span>  </span><br></pre></td></tr></table></figure></li>
<li>序列帧转为视频，cfhd、libx264等常用编码都可<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">ffmpeg -i /<span class="keyword">test</span>/<span class="keyword">test</span>%04d.jpg -vcodec mpeg4 <span class="keyword">test</span>.<span class="keyword">mov</span>  </span><br></pre></td></tr></table></figure></li>
<li>三个视频 01.mp4，02.mp4，03.mp4，按顺序连接合并成一个。  <figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">ffmpeg -i <span class="string">&quot;concat:01.mp4|02.mp4|03.mp4&quot;</span> -c <span class="keyword">copy</span> <span class="keyword">out</span>.mp4  </span><br></pre></td></tr></table></figure></li>
<li>给视频添加水印（可批量）。将logo.png作为水印，添加到离左上角（顶部和左边）分别20个像素位置。  <figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ffmpeg -<span class="selector-tag">i</span> <span class="keyword">in</span><span class="selector-class">.mp4</span> -<span class="selector-tag">i</span> logo<span class="selector-class">.png</span> -filter_complex <span class="string">&quot;overlay=20:20&quot;</span> out<span class="selector-class">.mp4</span>  </span><br></pre></td></tr></table></figure></li>
<li>截取一部分视频作为gif动图。例如：将视频的7.5秒到8.5秒截取，输出gif动图。 <figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ffmpeg</span> -i in.mp4 -ss <span class="number">7</span>.<span class="number">5</span> -to <span class="number">8</span>.<span class="number">5</span> -s <span class="number">640</span>x320 out.gif </span><br></pre></td></tr></table></figure></li>
<li>把视频缩放到原来一半尺寸大小<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">ffmpeg -i <span class="built_in">input</span>.avi -vf scale=<span class="string">&quot;iw/1:ih/2&quot;</span> <span class="built_in">output</span>.avi  </span><br></pre></td></tr></table></figure></li>
<li>缩放指定尺寸<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ffmpeg -<span class="selector-tag">i</span> <span class="selector-tag">input</span><span class="selector-class">.mp4</span> -s <span class="number">720</span>x480 -c:<span class="selector-tag">a</span> copy output.mp4</span><br></pre></td></tr></table></figure></li>
</ol>

  </div>
  <div id="gitalk-container"></div>
</div>

<script>
  
Fancybox.bind('[data-fancybox="fancybox-gallery-img"]', {
  dragToClose: true,
  Toolbar: true,
  closeButton: "top",
  Image: {
    zoom: true,
  },
  on: {
    initCarousel: (fancybox) => {
      const slide = fancybox.Carousel.slides[fancybox.Carousel.page];
      fancybox.$container.style.setProperty(
        "--bg-image",
        `url("${slide.$thumb.src}")`
      );
    },
    "Carousel.change": (fancybox, carousel, to, from) => {
      const slide = carousel.slides[to];
      fancybox.$container.style.setProperty(
        "--bg-image",
        `url("${slide.$thumb.src}")`
      );
    },
  },
});
</script>

<style>
    #noneimg img {
        display: none;
        z-index: 9999;
        /* width: 600px !important; */
        min-width: 0%;
        max-width: 90%;
        max-height: 80%;
        border-radius: 0px;
        position: fixed;
        box-shadow: 0 0 0px #c3c3c300 !important;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: auto !important;
    }

    @media screen and (max-width:600px) {
        #noneimg img {
            max-width: 88%
        }
    }
</style>

    <div class="post-paging">
    
    <a href="/2021/CG/other/Houdini_VDB/">
        <div class="post-paging-last">
            <span>上一篇</span>
            <p>Houdini细化VDB文件</p>
        </div>
    </a>
    

    
    <a href="/2021/CG/Comp/AE_OC_Multi/">
        <div class="post-paging-next">
            <span>下一篇</span>
            <p>OC多通道与AE后期简述</p>
        </div>
    </a>
    
</div>
</div>
		
<div class="footer">
	<div class="Copyright">
		©2025 By 可能是水桶吧 <br>备案信息：<a
			style="text-decoration: none;display: contents; color: #90defd;"
			target="_blank" rel="noopener" href="http://beian.miit.gov.cn">ICP-123456</a>
	</div>
	<div class="contact">
		
		<a target="_blank" rel="noopener" href="https://visnz.zcool.com.cn/">
			<img src="/assets/website/zcool-icon2.png" alt="Quiet主题">
		</a>
		
		<a target="_blank" rel="noopener" href="https://www.xiaohongshu.com/user/profile/599e99f650c4b40fb927384f">
			<img src="/assets/website/xhs-icon.png" alt="Quiet主题">
		</a>
		
		<a target="_blank" rel="noopener" href="https://space.bilibili.com/20477830">
			<img src="/assets/website/bilibili-icon.png" alt="Quiet主题">
		</a>
		
		<a href="/assets/blog/about/QQ_QRCode.jpg">
			<img src="/assets/website/QQ-icon.png" alt="Quiet主题">
		</a>
		
	</div>
	</div>
</div>

<script src="/js/gotop.js"></script>


<style type="text/css">
    @media screen and (min-width: 600px) {
        .goTop>span {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(18, 24, 58, 0.06);
            text-align: center;
            transition: border .5s;
            border: 1px solid rgba(18, 24, 58, 0.06);

            -moz-transition: border .5s;
            /* Firefox 4 */
            -webkit-transition: border .5s;
            /* Safari 和 Chrome */
            -o-transition: border .5s;
            /* Opera */
        }

        .goTop>span:hover {
            border: 1px solid #6680B3;
        }


        .goTop {
            position: fixed;
            right: 30px;
            bottom: 80px;
        }

        .goTop>span>svg {
            width: 20px;
            height: 20px;
            opacity: 0.7;
        }

    }

    @media screen and (max-width: 600px) {
        .goTop {
            display: none;
        }
    }
</style>
<div class="goTop" id="js-go_top">
    <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g>
                <path d="M13 12v8h-2v-8H4l8-8 8 8z"></path>
            </g>
        </svg>
    </span>
</div>
<script>
    $( '#js-go_top' )
	.gotoTop( {
		offset: 500,
		speed: 300,
		animationShow: {
			'transform': 'translate(0,0)',
			'transition': 'transform .5s ease-in-out'
		},
		animationHide: {
			'transform': 'translate(100px,0)',
			'transition': 'transform .5s ease-in-out'
		}
	} );
</script>
	</body>
</html>

